-- POPULANDO TABELA TL_ALUNO_CURSO

CREATE TABLE TL_ALUNO_CURSO (
    ID_ALUNO NUMBER(10,0) NOT NULL,
    ID_CURSO NUMBER(10,0) NOT NULL,
    NR_NOTA NUMBER(10,0) NOT NULL,
    ST_STATUS NVARCHAR2(20),
    DT_CONCLUSAO TIMESTAMP(7),
    CONSTRAINT FK_ALUNO_CURSO_ALUNO FOREIGN KEY (ID_ALUNO) REFERENCES TL_ALUNO(ID_ALUNO),
    CONSTRAINT FK_ALUNO_CURSO_CURSO FOREIGN KEY (ID_CURSO) REFERENCES TL_CURSO(ID_CURSO)
);

-- Populando a tabela com 5 registros relacionado entre TL_ALUNO e TL_CURSO
BEGIN
MERGE INTO TL_ALUNO_CURSO
USING (
  SELECT 1 AS ID_ALUNO, 1 AS ID_CURSO, 90 AS NR_NOTA, 'APROVADO' AS ST_STATUS, TO_TIMESTAMP('2023-05-14 10:00:00','YYYY-MM-DD HH24:MI:SS') AS DT_CONCLUSAO FROM DUAL UNION ALL
  SELECT 1 AS ID_ALUNO, 2 AS ID_CURSO, 80 AS NR_NOTA, 'APROVADO' AS ST_STATUS, TO_TIMESTAMP('2023-05-13 10:00:00','YYYY-MM-DD HH24:MI:SS') AS DT_CONCLUSAO FROM DUAL UNION ALL
  SELECT 2 AS ID_ALUNO, 1 AS ID_CURSO, 70 AS NR_NOTA, 'REPROVADO' AS ST_STATUS, TO_TIMESTAMP('2023-05-12 10:00:00','YYYY-MM-DD HH24:MI:SS') AS DT_CONCLUSAO FROM DUAL UNION ALL
  SELECT 2 AS ID_ALUNO, 2 AS ID_CURSO, 100 AS NR_NOTA, 'APROVADO' AS ST_STATUS, TO_TIMESTAMP('2023-05-11 10:00:00','YYYY-MM-DD HH24:MI:SS') AS DT_CONCLUSAO FROM DUAL UNION ALL
  SELECT 3 AS ID_ALUNO, 1 AS ID_CURSO, 60 AS NR_NOTA, 'REPROVADO' AS ST_STATUS, TO_TIMESTAMP('2023-05-10 10:00:00','YYYY-MM-DD HH24:MI:SS') AS DT_CONCLUSAO FROM DUAL
) DADOS
ON (TL_ALUNO_CURSO.ID_ALUNO = DADOS.ID_ALUNO AND TL_ALUNO_CURSO.ID_CURSO = DADOS.ID_CURSO)
WHEN MATCHED THEN UPDATE SET NR_NOTA = DADOS.NR_NOTA, ST_STATUS = DADOS.ST_STATUS, DT_CONCLUSAO = DADOS.DT_CONCLUSAO
WHEN NOT MATCHED THEN INSERT (ID_ALUNO, ID_CURSO, NR_NOTA, ST_STATUS, DT_CONCLUSAO) VALUES (DADOS.ID_ALUNO, DADOS.ID_CURSO, DADOS.NR_NOTA, DADOS.ST_STATUS, DADOS.DT_CONCLUSAO);
  COMMIT;
END;