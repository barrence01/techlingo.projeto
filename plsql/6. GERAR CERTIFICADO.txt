-- [Geração de certificados]
-- geração de certificado de todos os que concluiram
-- Deve-se ativar o buffer do dbms para ver o resultado. (View/Exibir > Saida Dbms/Dbms)

DECLARE
  v_aluno_nome TL_ALUNO.NM_ALUNO%TYPE;
  v_curso_nome TL_CURSO.NM_CURSO%TYPE;
  v_curso_duracao TL_CURSO.DS_DURACAO%TYPE;
  v_conclusao TL_ALUNO_CURSO.DT_CONCLUSAO%TYPE;
BEGIN
  FOR rec IN (SELECT ac.ID_ALUNO, a.NM_ALUNO, ac.ID_CURSO, c.NM_CURSO, c.DS_DURACAO, ac.DT_CONCLUSAO
              FROM TL_ALUNO_CURSO ac
              JOIN TL_ALUNO a ON ac.ID_ALUNO = a.ID_ALUNO
              JOIN TL_CURSO c ON ac.ID_CURSO = c.ID_CURSO
              WHERE ac.ST_STATUS = 'APROVADO')             
  LOOP
    v_aluno_nome := rec.NM_ALUNO;
    v_curso_nome := rec.NM_CURSO;
    v_curso_duracao := rec.DS_DURACAO;
    v_conclusao := rec.DT_CONCLUSAO;
    
    -- Aqui entra o código de geração do certificado, utilizando as variáveis acima
      -- Imprimir o certificado
      DBMS_OUTPUT.PUT_LINE('');
      DBMS_OUTPUT.PUT_LINE('CERTIFICADO');
      DBMS_OUTPUT.PUT_LINE('----------------------------------------------------');
      DBMS_OUTPUT.PUT_LINE('Certificamos que ' || v_aluno_nome || ' concluiu o curso ' || v_curso_nome);
      DBMS_OUTPUT.PUT_LINE('com duração de ' || v_curso_duracao || ', em ' || TO_CHAR(v_conclusao, 'DD/MM/YYYY'));
    
  END LOOP;
END;